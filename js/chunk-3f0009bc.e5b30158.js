(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-3f0009bc"],{1511:function(t,s,e){"use strict";e.r(s);var a=function(){var t=this,s=t._self._c;return s("div",{staticClass:"container"},[s("div",{staticClass:"row"},[s("div",{staticClass:"col"},[s("SideBar")],1),s("div",{staticClass:"col-7 scrollable-part"},[s("UserProfileCard",{attrs:{user:t.user},on:{"show-edit-modal":function(s){return t.toggleEditModal(!0)}}}),s("div",[s("ul",{staticClass:"nav-tab d-flex w-100"},t._l(t.tabs,(function(e){return s("li",{key:e.id,staticClass:"nav-item"},[s("router-link",{staticClass:"nav-link",attrs:{to:e.path}},[t._v(" "+t._s(e.title)+" ")])],1)})),0)]),s("router-view")],1),s("div",{staticClass:"col"},[s("PopularUsers",{on:{"change-count":t.handleChangeCount}})],1)]),s("UserEditModal",{attrs:{show:t.showEditModal},on:{close:function(s){return t.toggleEditModal(!1)},"after-edit-submit":t.afterEditSubmit}})],1)},r=[],i=(e("d9e2"),e("5ea5")),n=function(){var t=this,s=t._self._c;return s("div",{staticClass:"card-group"},[s("div",{staticClass:"card"},[s("div",{staticClass:"card-header mt-3"},[s("div",{staticClass:"d-flex align-items-center"},[s("div",{staticClass:"me-2"},[s("router-link",{attrs:{to:"/home"}},[s("img",{staticClass:"prev-icon",attrs:{src:e("8bcd"),alt:"..."}})])],1),s("div",[s("h5",{staticClass:"user-name m-0"},[t._v(" "+t._s(t.user.name)+" ")]),s("span",{staticClass:"card-text"},[t._v(t._s(t.user.tweetCounts)+" 推文")])])])]),s("div",{staticClass:"profile-wrapper position-relative"},[s("div",{staticClass:"profile-cover"},[s("img",{staticClass:"banner-img w-100",staticStyle:{height:"200px"},attrs:{src:t._f("emptyBanner")(t.user.banner),alt:"user-banner"}})]),s("div",{staticClass:"person-img"},[s("img",{staticClass:"avatar-img rounded-circle position-absolute",attrs:{src:t._f("emptyImage")(t.user.avatar)}})]),s("div",{staticClass:"d-flex justify-content-end"},[s("div",{staticClass:"d-flex justify-content-end"},[t.currentUser.id===+this.$route.params.id?s("button",{staticClass:"btn btn-edit btn-border btn-50",attrs:{type:"button"},on:{click:function(s){return s.stopPropagation(),s.preventDefault(),t.showEditModal(!0)}}},[t._v(" 編輯個人資料 ")]):t._e(),t.currentUser.id!==+this.$route.params.id?s("div",{staticClass:"icon-section"},[s("div",{staticClass:"icon-round"},[s("img",{staticClass:"icon",attrs:{src:e("b335")}})]),s("div",{staticClass:"icon-round"},[s("img",{staticClass:"icon",attrs:{src:e("37d7")}})]),s("button",{staticClass:"btn-border btn-50 btn-clip btn-edit",class:t.user.isFollowed,on:{click:[function(s){return t.changeFollowingCount(t.user.isFollowed)},function(s){return s.preventDefault(),s.stopPropagation(),t.toggleFollowUser(t.user.isFollowed,t.user.id)}]}},[t._v(t._s(t.user.isFollowed?"正在跟隨":"跟隨"))])]):t._e()])]),s("div",{staticClass:"card-body text-start"},[s("h5",{staticClass:"user-name"},[t._v(t._s(t.user.name))]),s("span",{staticClass:"card-text"},[t._v("@ "+t._s(t.user.account))]),s("p",{staticClass:"introduction"},[t._v(t._s(t.user.introduction))]),s("span",{staticClass:"card-text me-4"},[s("router-link",{attrs:{to:{name:"user-followings",params:{id:t.user.id}}}},[s("span",{staticClass:"num"},[t._v(t._s(t.user.followingCounts)+"個")]),t._v("跟隨中 ")])],1),s("span",{staticClass:"card-text"},[s("router-link",{attrs:{to:{name:"user-followers",params:{id:t.user.id}}}},[s("span",{staticClass:"num"},[t._v(t._s(t.user.followerCounts)+"位")]),t._v("追隨者 ")])],1)])])])])},o=[],l=e("2708"),c=e("2f62"),d=e("b025"),u=e("2fa3"),m=e("56d7"),A={name:"UserProfileCard",mixins:[l["b"]],data(){return{showProfileEditModal:!1,isEditing:!1,isLoading:!0}},props:{user:{Type:Array,required:!0}},methods:{showEditModal(t){this.$emit("show-edit-modal",t)},async toggleFollowUser(t,s){try{if(t){const t=await d["a"].unFollowUser(s);if("success"===t.data.status)u["a"].fire({icon:"success",title:"成功取消跟隨"});else if("error"===t.data.status)throw new Error(t.data.message)}else{const t=await d["a"].followUser(s);if("success"===t.data.status)u["a"].fire({icon:"success",title:"成功跟隨"});else if("error"===t.data.status)throw new Error(t.data.message)}}catch(e){console.error(e.response.data.message),u["a"].fire({icon:"error",title:e.response.data.message})}},viewingUser(){m["bus"].$emit("viewing-user",this.user)}},computed:{...Object(c["b"])(["currentUser"])}},p=A,g=(e("baf3"),e("2877")),h=Object(g["a"])(p,n,o,!1,null,null,null),f=h.exports,v=e("f963"),C=function(){var t=this,s=t._self._c;return s("div",[t.show?s("div",{staticClass:"modal-mask"},[s("div",{staticClass:"modal-container"},[s("form",{staticClass:"mx-auto w-100",on:{submit:function(s){return s.preventDefault(),s.stopPropagation(),t.handleEditModalSubmit.apply(null,arguments)}}},[s("div",{staticClass:"modal-header"},[s("div",{staticClass:"modal-title-wrapper d-flex"},[s("img",{staticClass:"close-btn",attrs:{src:e("ca79"),alt:"close-btn"},on:{click:function(s){return s.stopPropagation(),s.preventDefault(),t.$emit("close")}}}),s("div",{staticClass:"modal-title"},[t._v("編輯個人資料")])]),s("button",{staticClass:"save-btn btn-bg btn-border",attrs:{disabled:t.isProcessing}},[t._v(" 儲存 ")])]),s("div",{staticClass:"profile-wrapper position-relative"},[s("label",{staticClass:"banner-icon change-photo",attrs:{for:"banner-image"}}),t.isCancelBtnShown?s("label",{staticClass:"banner-icon cancel-change",on:{click:function(s){return s.preventDefault(),s.stopPropagation(),t.handleCancel.apply(null,arguments)}}}):t._e(),t.tempUser.banner?s("img",{staticClass:"banner-img w-100 banner-preview",attrs:{src:t.tempUser.banner}}):t._e(),t.tempUser.banner?t._e():s("img",{staticClass:"banner-img w-100",attrs:{src:t._f("emptyBanner")(t.currentUser.banner),alt:"banner"}}),s("input",{staticClass:"upload-banner",attrs:{name:"banner",type:"file",accept:"image/jpeg,image/png,image/webp",id:"banner-image"},on:{change:t.handleBannerChange}}),s("div",{staticClass:"bg-mask banner-mask"}),s("div",{staticClass:"person-img"},[s("label",{staticClass:"avatar-icon avatar-change-photo",attrs:{for:"avatar-image"}}),s("img",{staticClass:"avatar-img rounded-circle position-absolute",attrs:{src:t._f("emptyImage")(t.currentUser.avatar),alt:"person-image"}}),t.tempUser.avatar?s("img",{staticClass:"avatar-img rounded-circle position-absolute avatar-preview",attrs:{src:t.tempUser.avatar,width:"200",height:"200"}}):t._e(),s("input",{staticClass:"upload-avatar",attrs:{name:"avatar",type:"file",accept:"image/jpeg,image/png,image/webp",id:"avatar-image"},on:{change:t.handleAvatarChange}}),s("div",{staticClass:"avatar-mask"})])]),s("div",{staticClass:"modal-body"},[s("div",{staticClass:"form-input d-flex flex-column"},[s("label",{staticClass:"form-input-text",attrs:{for:"name"}},[t._v("名稱")]),s("input",{directives:[{name:"model",rawName:"v-model",value:t.tempUser.name,expression:"tempUser.name"}],class:{error:t.isNameInvalid},attrs:{type:"text",name:"name",id:"name",required:""},domProps:{value:t.tempUser.name},on:{input:[function(s){s.target.composing||t.$set(t.tempUser,"name",s.target.value)},function(s){t.isNameInvalid=!1}]}}),t.isNameInvalid?s("span",{staticClass:"error-message mx-3"},[t._v(t._s(t.nameErrorMessage))]):t._e()]),s("div",{staticClass:"form-input form-introduction d-flex"},[s("label",{staticClass:"form-input-text",attrs:{for:"introduction"}},[t._v("自我介紹")]),s("input",{directives:[{name:"model",rawName:"v-model",value:t.tempUser.introduction,expression:"tempUser.introduction"}],class:{error:t.isIntroTooLong},attrs:{type:"text",name:"introduction",id:"introduction",required:""},domProps:{value:t.tempUser.introduction},on:{input:[function(s){s.target.composing||t.$set(t.tempUser,"introduction",s.target.value)},function(s){t.isIntroTooLong=!1}]}}),t.isIntroTooLong?s("span",{staticClass:"error-message mx-3"},[t._v("自我介紹不可超過 160 字！")]):t._e()])])])])]):t._e()])},w=[],b=e("1602"),U={name:"UserEditModal",mixins:[l["b"]],data(){return{tempUser:{id:"",name:"",introduction:"",avatar:"",banner:""},isNameInvalid:!1,nameErrorMessage:"",isIntroTooLong:!1,isProcessing:!1,isCancelBtnShown:!1}},created(){this.tempUser.id=this.currentUser.id,this.tempUser.name=this.currentUser.name,this.tempUser.introduction=this.currentUser.introduction,this.tempUser.avatar=this.currentUser.avatar,this.tempUser.banner=this.currentUser.banner},props:{show:Boolean},computed:{...Object(c["b"])(["currentUser"])},methods:{async handleEditModalSubmit(t){try{if(!this.tempUser.name)return this.isNameInvalid=!0,void(this.nameErrorMessage="名稱不可空白");if(this.tempUser.name.length>50)return this.isNameInvalid=!0,void(this.nameErrorMessage="名稱不可超過 50 字！");if(this.tempUser.introduction.length>160)return void(this.isIntroTooLong=!0);this.isProcessing=!0;const s=t.target,e=new FormData(s),a=await b["a"].editSelfData({userId:this.tempUser.id,formData:e});if("error"===a.data.status)throw new Error(a.data.message);this.$emit("after-edit-submit"),u["a"].fire({icon:"success",title:"更改個人資料成功！"}),this.$emit("close"),this.isProcessing=!1}catch(s){switch(this.isProcessing=!1,console.error(s.response.data.message),s.response.data.message){case"permission denied":u["a"].fire({icon:"error",title:"您沒有權限修改"});break;case"Error: Target user not exist":u["a"].fire({icon:"error",title:"使用者不存在"});break;default:u["a"].fire({icon:"error",title:"修改個人資料失敗，請再試一次"});break}}},handleAvatarChange(t){const{files:s}=t.target;if(0!==s.length){const t=window.URL.createObjectURL(s[0]);this.tempUser.avatar=t}},handleBannerChange(t){const{files:s}=t.target;if(0!==s.length){this.isCancelBtnShown=!0;const t=window.URL.createObjectURL(s[0]);this.tempUser.banner=t,console.log(this.tempUser.banner)}},handleCancel(){this.tempUser.banner="",this.isCancelBtnShown=!1}}},B=U,E=(e("6208"),Object(g["a"])(B,C,w,!1,null,"5feec354",null)),x=E.exports,I={name:"User",components:{SideBar:i["a"],UserProfileCard:f,PopularUsers:v["a"],UserEditModal:x},created(){const{id:t}=this.$route.params;this.fetchUserProfile(t)},beforeRouteUpdate(t,s,e){const{id:a}=t.params;this.fetchUserProfile(a),e()},data(){return{tabs:[{title:"推文",path:"tweets"},{title:"回覆",path:"replies"},{title:"喜歡的內容",path:"likes"}],currentUser:{},tweets:[],showEditModal:!1,user:{id:-1,account:"",name:"",email:"",introduction:"",avatar:"",banner:"",tweetCounts:0,followingCounts:0,followerCounts:0,likeCount:0,isFollowed:!1}}},methods:{toggleEditModal(t){this.showEditModal=t},handleChangeCount(t){!1===t&&(this.user.followingCounts=this.user.followingCounts+1),!0===t&&(this.user.followingCounts=this.user.followingCounts-1)},async fetchUserProfile(t){try{const s=await b["a"].getUser({userId:t});if(200!==s.status)throw new Error(s.data.message);this.user=s.data,this.user={...this.user,introduction:this.user.introduction?this.user.introduction:""},this.isLoading=!1}catch(s){this.isLoading=!1,u["a"].fire({icon:"error",title:"無法取得使用者資料，請稍後再試"})}},afterEditSubmit(){this.fetchUserProfile(this.user.id)}}},_=I,k=(e("9462"),Object(g["a"])(_,a,r,!1,null,"4741bc4c",null));s["default"]=k.exports},"37d7":function(t,s){t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAJvSURBVHgB7ZjNUcMwEIUfPwdumAriDuDILekAOog6CB0YKgAqCB0AFThUAFQQU0GgAtCOlWEtJFuSJeLM5Jt5E8WWJe1qJa0NDJtSaYQt5ELqW2luq7SP4XLiUmnIBjix9QYcoh8Z6ljNldZUUgupd6lPJCTUgKmUkJo41H2SupN6sdzPVHuZdv1MKxeGZx/gyVhqid/dwUe27XAe2B5p6TMD5IFrw/WF1BvqcCGOUYfTBE0v0v9K6krqHpHYc6xHXhLsP8X1nRpIW4znqA0X2vVrqRtVptCZGZ4l4y9VmRz0ZKjzAAdoAHooZPAjx9/Qm3Y8I+BwkHUx1TotEA4Z/craWqE9RRCIYAD32iP6k2ltli11BXoawL1PnY4Qh1M0Z3VsqSfQ0wDuqa549YWvK9ssCPQwYIym92OToTkLmaUOha3t/Ghlzhq/RRpKRJhhWzLHD6BnpIHv6xNEpmt6Y8DD9BURyZE2/k39rBCIKYT4gqmQjoqVg2d590a2aTZtAM9kg8LIZEBm6SAFvP1jBGAygJ8BFdLyZunXmS4DFkhLxco5Augy4ANpeWflS0QgdRKnw5O6FQIWsj4DgpUXSM8n68f2buxMjmYO5J3CBjJDz1lYw1PoEv8HDXiFnul7gc14f81M6//C52F98EPRGA7QIo6yfSVAuFQ6kDqSOle/Q6FCbcAXIrOE/zo5Q6I3L8I3G+W5i4AbPJYrbBgBvz07R9rvS97onwYpJEYtdfm30P9ITZygkODbHQ2MPHuq7pNBBZqHk/fenhoaoM+eXmCAkNd5OJlE9ycYOGRIiV9jluo/pQepPort2LFD8QNN6BgVYDMdzAAAAABJRU5ErkJggg=="},"57af":function(t,s,e){},6208:function(t,s,e){"use strict";e("c090")},"6a2b":function(t,s,e){},"8bcd":function(t,s){t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACIAAAAcCAYAAAAEN20fAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAB5SURBVHgB7dfBCYAwEETR0Qoswc6SzreEpAPNQg5R4kGFnct8GMnNBwoi8L7UVtqsnyn5jY9hBYTuCJ8huBnClxGYEEIIIcRXRNTMDUs/7OBW13bZwK/6JYP7aAqGd/EJk0AoQxhhhBEmHkP5r5lhDMRyB1y+EX87AdxCwzt7prpuAAAAAElFTkSuQmCC"},9462:function(t,s,e){"use strict";e("57af")},b335:function(t,s){t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAlCAYAAAAwYKuzAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAFMSURBVHgB7ZjhDYIwEIWfTtIRHKGjuIErdAQ3wE0cQTdwBNxAe0LxwBaBK7Q/+pJLtBj48tnas8A3ytbZ1sPWK1HdbFUtSy8HW3VCsGHVLVNnLic4DklsuLDBhy2NdNHoTzGacr0BjfTRYMJ27QuXHfJIx7RH5hkCVvAs8Q2jbF2Hg8PVQ3PyiO1zgv/XJLjMt7Kp0FgLcfzY29Kmz9odI4AUg/VtKvitmfb6KKC7wVo2Q9YO7DN/AV0M4tlUGLeGJYDuxlKbU6wtBnQxmG+Trk21JgZ0D5xqc661KIAuBmGbVEusRQUE/DZ9NdVadEAXgzCcwbJEBaQoNI0v/acgq/R1z7XG0zGVflCaAihNAZSmAEpTAKUhwCd7r5E+fIv8sNEBDe/tJHuoNBr9Don29GyP315g3foxM7Aani5doWmZUtqkZ1dIez40L296frZwQEKmnAAAAABJRU5ErkJggg=="},baf3:function(t,s,e){"use strict";e("6a2b")},c090:function(t,s,e){}}]);
//# sourceMappingURL=chunk-3f0009bc.e5b30158.js.map